\begin{frame}{Valgrind}
	\begin{itemize}
		\item Valgrind ist ein Framework um dynamische Analyseprogramme (Tools) zu entwickeln
		\pause \item Valgrind ist eine virtuelle Maschine und JIT Compiler
		\pause \item Valgrind verwendet Dynamic Binary Translation (DBT)
        \pause \item Verwendet (dynamisch gelinkte) ELF Binärdateien $\rightarrow$ kein erneutes Kompilieren
		\pause \item Tools führen Analyse und/oder Instrumentierung durch
		\pause \item Einfachste Tools können mit nur vier Funktionen implementiert werden
		\pause \item{\bf Tools:} Memcheck, Cachegrind, Callgrind, {\bf McTracer} 
	\end{itemize}
\end{frame}

\subsection{Valgrind Workflow}

\begin{frame}{Valgrind Workflow}
	\begin{enumerate}
		\item Das Programm wird eingelesen und in die Vex Intermediate Representation (UCode) überführt
		\pause \item IRSBs (IR Super Block) werden an das Tool übergeben 
		\pause \item Das Skin instrumentiert/analysiert die IRSBs
		\pause \item Die IRSBs werden zu Maschinencode kompiliert und auf Valgrinds CPU ausgeführt
	\end{enumerate}
\end{frame}

\begin{frame}{Darstellung des Maschinencodes in Vex IR}
	\lstset{frame=single}
	\lstinputlisting[language=C, basicstyle=\tiny]{mctracer/irsb.c}
\end{frame}

\begin{frame}{Instrumentierung}
	\lstset{frame=single}
	\lstinputlisting[language=C, basicstyle=\tiny]{mctracer/instrument.c}	
\end{frame}

\subsection{Valgrind Client Requests}

\begin{frame}{Valgrind Client Requests}
	\begin{itemize}
		\item Client Requests erlauben dem analysierten Programm mit Valgrind bzw. dem Tool zu kommunizieren
		\pause \item Client Requests sind ein Trapdoor Mechanismus
		\pause \item Werden bei McTracer verwendet, um die zu analysierenden Datenstrukturen festzulegen
	\end{itemize}

	\pause

	\lstset{frame=single}
	\lstinputlisting[language=C, basicstyle=\tiny]{mctracer/client_example.c}
\end{frame}

\begin{frame}{Valgrind Client Requests}
	\lstset{frame=single}
	\lstinputlisting[language=C, basicstyle=\tiny]{mctracer/client_impl.c}	
\end{frame}

\begin{frame}{Valgrind Client Request Internals}
	\lstset{frame=single}
	\lstinputlisting[language=C, basicstyle=\tiny]{mctracer/client_request_valgrind.c}	
\end{frame}
